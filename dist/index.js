!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).wtfJson=t()}(this,(function(){"use strict";class e{getErrorMessage(e){return`"${e.value}" is not valid JSON\nline: ${e.startLine}, column: ${e.startColumn}`}formatStr(e){const t=/(`|'|")/.test(e.charAt(0))&&/(`|'|")/.test(e.charAt(e.length-1))?e.substring(1,e.length-1):e;return t.replace(/\\(.)/g,(function(e,t){return"n"===t?"\n":"r"===t?"\r":"t"===t?"\t":"b"===t?"\b":"f"===t?"\f":"v"===t?"\v":t}))}appendBoolean(e){return{type:"BOOLEAN",value:"TRUE_BOOLEAN"===e.type}}appendNullValue(e){return{type:"NULL_VALUE",value:null}}appendUndefinedValue(e){return{type:"UNDEFINED_VALUE",value:void 0}}appendNaNValue(e){return{type:"NAN_VALUE",value:NaN}}appendString(e){return{type:"STRING",value:this.formatStr(e.value)}}appendArray(e){return{type:"ARRAY",properties:[]}}appendObject(e){return{type:"OBJECT",properties:[]}}appendNumber(e){return{type:"NUMBER",value:Number(e.value)}}appendKey(e){return{type:"OBJECT_KEY",name:this.formatStr(e.value),value:null}}buildAST(e){const t={type:"JSON",properties:[]},n=[t];for(let t=0;t<e.length;++t){const s=e[t],r=n[n.length-1],p=e=>{"value"in r?r.value=e:r.properties.push(e)};if("TRUE_BOOLEAN"===s.type||"FALSE_BOOLEAN"===s.type)p(this.appendBoolean(s));else if("NULL"===s.type)p(this.appendNullValue(s));else if("UNDEFINED"===s.type)p(this.appendUndefinedValue(s));else if("NAN"===s.type)p(this.appendNaNValue(s));else if("NUMBER"===s.type)p(this.appendNumber(s));else if("STRING"===s.type||"UNKNOWN"===s.type)if("OBJECT_KEY"===r.type&&null!==r.value&&n.pop(),"OBJECT"===r.type){const e=this.appendKey(s);p(e),n.push(e)}else p(this.appendString(s));else if("START_BRACKET"===s.type){const e=this.appendArray(s);p(e),n.push(e)}else if("START_BRACE"===s.type){const e=this.appendObject(s);p(e),n.push(e)}else"END_BRACKET"===s.type&&1!==n.length?n.pop():"END_BRACE"===s.type&&1!==n.length?("OBJECT_KEY"===r.type&&n.pop(),n.pop()):"COMA"===s.type?"OBJECT_KEY"===r.type&&n.pop():s.type;s.type}return t}}const t={defaultType:"UNKNOWN",concatDefaultType:!0};class n{constructor(e){if(!e||!e.tokens)throw new Error('Invalide options: "tokens" is required');this.options=Object.assign({},t,e)}getDefaultType(){return this.options.defaultType}getTokens(){return this.options.tokens}getTokensName(){return[...Object.keys(this.options.tokens),this.getDefaultType()]}matcher(e,t,n){n.lastIndex=0;const s=n.exec(e);return s?{type:t,value:s[0],groups:s.groups,index:s.index}:null}tokenize(e){var t,n,s,r,p;if("string"!=typeof e)return[];const o=[],i=this.getDefaultType(),l=this.options.concatDefaultType,a=this.options.tokens;for(let u=0;u<e.length;++u){const h=e.substring(u,e.length),d=e.substring(0,u),c={type:i,value:h.charAt(0),index:0};let E=c;const N=Object.entries(a).reverse();for(const[e,t]of N){const n=this.matcher(h,e,t);null!==n&&(0===n.index?E=n:this.options.prioritize&&E!==c&&E.value.length>n.index&&(E=c))}const y=E.value.split(/\n/g),T=null!==(n=null===(t=d.match(/\n/g))||void 0===t?void 0:t.length)&&void 0!==n?n:0,f=T+Math.max(y.length-1,0),A=null!==(p=null===(r=null===(s=d.split(/\n/g))||void 0===s?void 0:s[T])||void 0===r?void 0:r.length)&&void 0!==p?p:0,g=y[y.length-1].length+(T===f?A:0);let v={type:E.type,value:E.value,...E.groups?{groups:E.groups}:{},startLine:T,startColumn:A,endLine:f,endColumn:g};if(v=this.options.callback?this.options.callback(v,o):v,u+=E.value.length-1,null===v)continue;if(!this.options.authorizeAdditionalTokens&&!this.getTokensName().includes(v.type))throw new Error(`Unknown token type returned by the callback: "${v.type}" (If you want to allow other types please set authorizeAdditionalTokens to true)`);const O=v.type===i;if(l&&O&&0!==o.length&&o[o.length-1].type===i){const e=o[o.length-1];e.value+=v.value,e.endColumn=v.endColumn,e.endLine=v.endLine}else o.push(v)}return o}}n.BUILT_IN_RULES={WORD:/\w+/,NUMBER:/\d+(?:\.\d+)?/,ONE_LINE_COMMENT:/\/\/.*/,MULTIPLE_LINE_COMMENT:/\/\*[\s\S]*?\*\//,STRING:/("|'|`)(?<content>(?:\\\1|.)*?)\1/,DOUBLE_QUOTE_STRING:/(")(?<content>(?:\\\1|.)*?)\1/,SINGLE_QUOTE_STRING:/(')(?<content>(?:\\\1|.)*?)\1/,GRAVE_ACCENT_STRING:/(`)(?<content>(?:\\\1|.)*?)\1/,WHITE_SPACES:/\s+/,NEW_LINES:/\n+/};const s={STRING:/("|'|`)(?:\\\1|.|\n)*?\1/,NUMBER:/(?:\d+(?:\.\d*)?)|(?:\.\d+)/,WHITE_SPACE:/\s+/,COMA:/,/,COLON:/:/,TRUE_BOOLEAN:/true/,FALSE_BOOLEAN:/false/,NULL:/null/,UNDEFINED:/undefined/,NAN:/NaN/,START_BRACKET:/\[/,END_BRACKET:/\]/,START_BRACE:/\{/,END_BRACE:/\}/};const r=new class{constructor(){this.tokenizer=new n({tokens:s}),this.astBuilder=new e}parse(e){e=String(e);const t=this.tokenizer.tokenize(e),n=this.astBuilder.buildAST(t);return n.properties.length>1?n.properties.map((e=>this.parseASTBranch(e))):n.properties.length>0?this.parseASTBranch(n.properties[0]):void 0}parseASTBranch(e){return"OBJECT"===e.type?this.parseObject(e):"ARRAY"===e.type?this.parseArray(e):this.parsePrimitif(e)}parseArray(e){const t=[];for(const n of e.properties)t.push(this.parseASTBranch(n));return t}parseObject(e){const t={};for(const n of e.properties)"OBJECT_KEY"===n.type&&(t[n.name]=null===n.value?null:this.parseASTBranch(n.value));return t}parsePrimitif(e){return e.value}};return r.parse.bind(r)}));
//# sourceMappingURL=index.js.map
